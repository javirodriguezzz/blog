<!doctype html><html lang=en-us><head><title>Search automation in Shodan [EN] // Javier Rodr√≠guez</title><link rel="shortcut icon" href=/favicon.ico><meta charset=utf-8><meta name=generator content="Hugo 0.100.1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="Javier Rodriguez Campo"><meta name=description content><link rel=stylesheet href=https://jrcampo.com/css/main.min.4c90ea63ff8730316d9dd2a0d1670b768d778c8c6622fe9c0adce2c9fb0e3a01.css><meta name=twitter:card content="summary"><meta name=twitter:title content="Search automation in Shodan [EN]"><meta name=twitter:description content="¬øWhat is Shodan? üïµÔ∏è‚Äç‚ôÇÔ∏è Shodan is a search engine which uses a database of billions of publicly available IP addresses from a large number of systems, specially IoT devices. It can find anything that connects directly to te internet and if its devices aren&rsquo;t protected, so can tell everything people with bad intentions need to know to break into your network.
In this case, a Python script was developed to perform search automation of desired queries on Shodan."><meta property="og:title" content="Search automation in Shodan [EN]"><meta property="og:description" content="¬øWhat is Shodan? üïµÔ∏è‚Äç‚ôÇÔ∏è Shodan is a search engine which uses a database of billions of publicly available IP addresses from a large number of systems, specially IoT devices. It can find anything that connects directly to te internet and if its devices aren&rsquo;t protected, so can tell everything people with bad intentions need to know to break into your network.
In this case, a Python script was developed to perform search automation of desired queries on Shodan."><meta property="og:type" content="article"><meta property="og:url" content="https://jrcampo.com/posts/first-post/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-24T20:03:28+02:00"><meta property="article:modified_time" content="2022-03-24T20:03:28+02:00"></head><body><header class=app-header><a href=https://jrcampo.com/><img class=app-header-avatar src=/curriculum.png alt="Javier Rodriguez Campo"></a><h1>Javier Rodr√≠guez</h1><nav class=app-header-menu><a class=app-header-menu-item href=/about/>About Me</a>
|
<a class=app-header-menu-item href=/posts/>Posts</a>
|
<a class=app-header-menu-item href=/social/>Social Media</a></nav><p>MSc Cibersecurity Student</p><div class=app-header-social><a href=https://linkedin.com/in/jrcampo target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-linkedin"><title>LinkedIn</title><path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6z"/><rect x="2" y="9" width="4" height="12"/><circle cx="4" cy="4" r="2"/></svg></a><a href=https://twitter.com/jrodriguezz24 target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-twitter"><title>Twitter</title><path d="M23 3a10.9 10.9.0 01-3.14 1.53 4.48 4.48.0 00-7.86 3v1A10.66 10.66.0 013 4s-4 9 5 13a11.64 11.64.0 01-7 2c9 5 20 0 20-11.5a4.5 4.5.0 00-.08-.83A7.72 7.72.0 0023 3z"/></svg></a><a href=https://github.com/javirodriguezzz target=_blank rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>Github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0020 4.77 5.07 5.07.0 0019.91 1S18.73.65 16 2.48a13.38 13.38.0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 005 4.77 5.44 5.44.0 003.5 8.55c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 009 18.13V22"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>Search automation in Shodan [EN]</h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>Mar 24, 2022</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>4 min read</div></div></header><div class=post-content><style>p{text-align:justify}li{text-align:justify}img{width:30%;height:30%;display:block;margin:auto}tbody{border-collapse:collapse;border:2px #29f3c3}</style><h1 id=what-is-shodan->¬øWhat is <em>Shodan</em>? üïµÔ∏è‚Äç‚ôÇÔ∏è</h1><p><a href=https://www.shodan.io/>Shodan</a> is a search engine which uses a database of billions of publicly available IP addresses from a large number of systems, specially IoT devices. It can find anything that connects directly to te internet and if its devices aren&rsquo;t protected, so can tell everything people with bad intentions need to know to break into your network.</p><p>In this case, a Python script was developed to perform search automation of desired queries on Shodan. It gives a detailed inform of each result in the search, including vulnerabilities and exploits. It can be found in the <a href=https://github.com/javirodriguezzz/Shodan-Browser>following GitHub repo</a>.</p><h3 id=files>Files</h3><ul><li><strong>main.py</strong><br>Script which uses the Shodan API for search and obtain an inform from a query.</li><li><strong>shodan-results.txt</strong><br>Example results obtained by the script.</li></ul><h3 id=script-usage>Script usage</h3><ul><li><strong>-q &ldquo;Desired query&rdquo;</strong><br>Search a defined query.</li><li><strong>-f &ldquo;queries.txt&rdquo;</strong><br>Search from a file with a list of queries.</li></ul><h3 id=main-method>Main method</h3><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>shodan_search</span>(query, filepath):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>        results <span style=color:#f92672>=</span> api<span style=color:#f92672>.</span>search(query)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        f <span style=color:#f92672>=</span> open(filepath, <span style=color:#e6db74>&#34;w&#34;</span>)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> result <span style=color:#f92672>in</span> results[<span style=color:#e6db74>&#39;matches&#39;</span>]:
</span></span><span style=display:flex><span>            vuln_index <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>            f<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#34;IP: &#34;</span> <span style=color:#f92672>+</span> result[<span style=color:#e6db74>&#39;ip_str&#39;</span>])
</span></span><span style=display:flex><span>            f<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Product: &#34;</span> <span style=color:#f92672>+</span> str(result[<span style=color:#e6db74>&#39;http&#39;</span>][<span style=color:#e6db74>&#39;server&#39;</span>]))
</span></span><span style=display:flex><span>            <span style=color:#75715e># f.write(&#34;\nInfo: &#34; + str(result[&#39;info&#39;]))</span>
</span></span><span style=display:flex><span>            f<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>OS: &#34;</span> <span style=color:#f92672>+</span> str(result[<span style=color:#e6db74>&#39;os&#39;</span>]))
</span></span><span style=display:flex><span>            f<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Organization: &#34;</span> <span style=color:#f92672>+</span> str(result[<span style=color:#e6db74>&#39;org&#39;</span>]))
</span></span><span style=display:flex><span>            f<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Ubication: &#34;</span> <span style=color:#f92672>+</span> result[<span style=color:#e6db74>&#39;location&#39;</span>][<span style=color:#e6db74>&#39;city&#39;</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;, &#34;</span> <span style=color:#f92672>+</span> str(result[<span style=color:#e6db74>&#39;location&#39;</span>][<span style=color:#e6db74>&#39;longitude&#39;</span>]) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;/&#34;</span> <span style=color:#f92672>+</span> str(result[<span style=color:#e6db74>&#39;location&#39;</span>][<span style=color:#e6db74>&#39;latitude&#39;</span>]) <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;, &#34;</span> <span style=color:#f92672>+</span> result[<span style=color:#e6db74>&#39;location&#39;</span>][<span style=color:#e6db74>&#39;country_name&#39;</span>])
</span></span><span style=display:flex><span>            ports <span style=color:#f92672>=</span> api<span style=color:#f92672>.</span>host(result[<span style=color:#e6db74>&#39;ip_str&#39;</span>])
</span></span><span style=display:flex><span>            f<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Open ports: &#34;</span> <span style=color:#f92672>+</span> str(ports))
</span></span><span style=display:flex><span>            f<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Vulnerabilities: &#34;</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> vuln <span style=color:#f92672>in</span> result[<span style=color:#e6db74>&#39;vulns&#39;</span>]:
</span></span><span style=display:flex><span>                    f<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>  - &#34;</span> <span style=color:#f92672>+</span> vuln)
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>if</span> vuln_index <span style=color:#f92672>!=</span> <span style=color:#ae81ff>3</span>:
</span></span><span style=display:flex><span>                        exploits_api_url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;https://exploits.shodan.io/api/search?query=</span><span style=color:#e6db74>{query}</span><span style=color:#e6db74>&amp;key=</span><span style=color:#e6db74>{api_key}</span><span style=color:#e6db74>&#34;</span>
</span></span><span style=display:flex><span>                        exploit_query <span style=color:#f92672>=</span> exploits_api_url<span style=color:#f92672>.</span>format(query<span style=color:#f92672>=</span>vuln,
</span></span><span style=display:flex><span>                                                                api_key<span style=color:#f92672>=</span>API_KEY)
</span></span><span style=display:flex><span>                        response <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(exploit_query)
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>try</span>:
</span></span><span style=display:flex><span>                            response_json <span style=color:#f92672>=</span> response<span style=color:#f92672>.</span>json()
</span></span><span style=display:flex><span>                            <span style=color:#66d9ef>if</span> len(response_json[<span style=color:#e6db74>&#39;matches&#39;</span>]) <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>:
</span></span><span style=display:flex><span>                                <span style=color:#66d9ef>for</span> match <span style=color:#f92672>in</span> response_json[<span style=color:#e6db74>&#39;matches&#39;</span>]:
</span></span><span style=display:flex><span>                                    f<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Exploit: &#39;</span> <span style=color:#f92672>+</span> match[<span style=color:#e6db74>&#39;description&#39;</span>])
</span></span><span style=display:flex><span>                                    print(<span style=color:#e6db74>&#39;¬°Exploit found! IP: &#39;</span> <span style=color:#f92672>+</span> result[<span style=color:#e6db74>&#39;ip_str&#39;</span>])
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>ValueError</span>:
</span></span><span style=display:flex><span>                            print(<span style=color:#e6db74>&#39;No exploits found for device &#39;</span> <span style=color:#f92672>+</span> result[<span style=color:#e6db74>&#39;ip_str&#39;</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;(&#34;</span> <span style=color:#f92672>+</span> vuln <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;)&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    vuln_index <span style=color:#f92672>=</span> vuln_index <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>                    time<span style=color:#f92672>.</span>sleep(<span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>except</span> <span style=color:#a6e22e>KeyError</span>:
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>pass</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            f<span style=color:#f92672>.</span>write(<span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\n\n</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        f<span style=color:#f92672>.</span>close()
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Search finished for query: &#34;</span> <span style=color:#f92672>+</span> query)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>except</span> shodan<span style=color:#f92672>.</span>APIError <span style=color:#66d9ef>as</span> e:
</span></span><span style=display:flex><span>        print(<span style=color:#e6db74>&#34;Error: &#34;</span> <span style=color:#f92672>+</span> str(e))
</span></span></code></pre></div><h3 id=output-example>Output example</h3><blockquote><p>IP: 185.X.X.X<br>Product: 360 web server, 792/71644 HTTP Server version 2.0 - TELDAT S.A.<br>OS: None<br>Organization: LTD HOSTPRO LAB<br>Ubication: Kyiv, 30.5238/50.45466, Ukraine<br>Open ports: 37215<br>Vulnerabilities:</p><ul><li><strong>CVE-2019-1552</strong><br><strong>Exploit:</strong> OpenSSL has internal defaults for a directory tree where it can find a configuration file as well as
certificates used for verification in TLS. This directory is most commonly referred to as OPENSSLDIR,
and is configurable with the &ndash;prefix / &ndash;openssldir configuration options. For OpenSSL versions 1.1.0 and
1.1.1, the mingw configuration targets assume that resulting programs and libraries are installed in a Unix-like environment and the default prefix for program installation as well as for OPENSSLDIR should be &lsquo;/usr/local&rsquo;. However, mingw programs are Windows programs, and as such, find themselves looking at sub-directories of &lsquo;C:/usr/local&rsquo;, which may be world writable, which enables untrusted users to modify OpenSSL&rsquo;s default configuration, insert CA certificates, modify (or even replace) existing engine modules, etc. For OpenSSL 1.0.2, &lsquo;/usr/local/ssl&rsquo; is used as default for OPENSSLDIR on all Unix and Windows targets, including Visual C builds. However, some build instructions for the diverse Windows targets on 1.0.2 encourage you to specify your own &ndash;prefix. OpenSSL versions 1.1.1, 1.1.0 and 1.0.2 are affected by this issue. Due to the limited scope of affected deployments this has been assessed as low severity and therefore we are not creating new releases at this time. Fixed in OpenSSL 1.1.1d (Affected 1.1.1-1.1.1c). Fixed in OpenSSL 1.1.0l (Affected 1.1.0-1.1.0k). Fixed in OpenSSL 1.0.2t (Affected 1.0.2-1.0.2s).</li><li>CVE-2018-0737<br><strong>Exploit:</strong> The OpenSSL RSA Key generation algorithm has been shown to be vulnerable to a cache timing side channel attack. An attacker with sufficient access to mount cache timing attacks during the RSA key generation process could recover the private key. Fixed in OpenSSL 1.1.0i-dev (Affected 1.1.0-1.1.0h). Fixed in OpenSSL 1.0.2p-dev (Affected 1.0.2b-1.0.2o).</li><li><strong>CVE-2018-0734</strong></li><li><strong>CVE-2018-0732</strong></li><li><strong>CVE-2017-3737</strong><br><strong>Exploit:</strong> Node.js was affected by OpenSSL vulnerability CVE-2017-3737 in regards to the use of SSL_read() due to TLS handshake failure. The result was that an active network attacker could send application data to Node.js using the TLS or HTTP2 modules in a way that bypassed TLS authentication and encryption.<br><strong>Exploit:</strong> OpenSSL 1.0.2 (starting from version 1.0.2b) introduced an &ldquo;error state&rdquo; mechanism. The intent was that if a fatal error occurred during a handshake then OpenSSL would move into the error state and would immediately fail if you attempted to continue the handshake. This works as designed for the explicit handshake functions (SSL_do_handshake(), SSL_accept() and SSL_connect()), however due to a bug it does not work correctly if SSL_read() or SSL_write() is called directly. In that scenario, if the handshake fails then a fatal error will be returned in the initial function call. If SSL_read()/SSL_write() is subsequently called by the application for the same SSL object then it will succeed and the data is passed without being decrypted/encrypted directly from the SSL/TLS record layer. In order to exploit this issue an application bug would have to be present that resulted in a call to SSL_read()/SSL_write() being issued after having already received a fatal error. OpenSSL version 1.0.2b-1.0.2m are affected. Fixed in OpenSSL 1.0.2n. OpenSSL 1.1.0 is not affected.</li></ul></blockquote><h4 id=disclaimer-the-usage-of-this-script-its-only-for-academic-purposes>Disclaimer: <strong>The usage of this script it&rsquo;s only for academic purposes</strong>.</h4></div><div class=post-footer></div></article></main></body></html>